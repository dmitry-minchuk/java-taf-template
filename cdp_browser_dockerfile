FROM debian:bullseye-slim

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    chromium \
    socat \
    net-tools \
    curl \
    ca-certificates \
    --no-install-recommends && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

EXPOSE 9222

CMD sh -c '\
  chromium \
    --headless=new \
    --no-sandbox \
    --disable-dev-shm-usage \
    --disable-gpu \
    --disable-software-rasterizer \
    --remote-debugging-address=127.0.0.1 \
    --remote-debugging-port=9223 \
    --disable-features=ChromeBrowserCloudManagement \
    & \
  sleep 2 && \
  socat TCP-LISTEN:9222,fork TCP:127.0.0.1:9223'
